FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.version"="0.1.0"
LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IGtleWNsb2FrLWFwYgpkZXNjcmlwdGlvbjogS2V5Y2xvYWsgLSBP\
cGVuIFNvdXJjZSBJZGVudGl0eSBhbmQgQWNjZXNzIE1hbmFnZW1lbnQKYmluZGFibGU6IFRydWUK\
YXN5bmM6IHJlcXVpcmVkCnRhZ3M6IAogIC0gbW9iaWxlLXNlcnZpY2UKICAtIG1vYmlsZS1jbGll\
bnQtZW5hYmxlZAptZXRhZGF0YToKICBkaXNwbGF5TmFtZTogS2V5Y2xvYWsKICBpbWFnZVVybDog\
Imh0dHBzOi8vcGJzLnR3aW1nLmNvbS9wcm9maWxlX2ltYWdlcy83MDIxMTk4MjE5NzkzNDQ4OTcv\
b0FDMDVjRUJfNDAweDQwMC5wbmciCiAgZG9jdW1lbnRhdGlvblVybDogImh0dHA6Ly93d3cua2V5\
Y2xvYWsub3JnL2RvY3VtZW50YXRpb24uaHRtbCIKICBwcm92aWRlckRpc3BsYXlOYW1lOiAiUmVk\
IEhhdCwgSW5jLiIKICBkZXBlbmRlbmNpZXM6CiAgICAtICJkb2NrZXIuaW8vamJvc3Mva2V5Y2xv\
YWstb3BlbnNoaWZ0OjMuNC4zLkZpbmFsIgogICAgLSAiZG9ja2VyLmlvL2NlbnRvcy9wb3N0Z3Jl\
c3FsLTk2LWNlbnRvczc6OS42IgogIHNlcnZpY2VOYW1lOiBrZXljbG9hawpwbGFuczoKICAtIG5h\
bWU6IGRlZmF1bHQKICAgIGRlc2NyaXB0aW9uOiBEZXBsb3kga2V5Y2xvYWsKICAgIGZyZWU6IFRy\
dWUKICAgIG1ldGFkYXRhOiB7fQogICAgcGFyYW1ldGVyczogCiAgICAtIG5hbWU6IEFETUlOX1VT\
RVJOQU1FCiAgICAgIHJlcXVpcmVkOiBUcnVlCiAgICAgIGRlZmF1bHQ6IGFkbWluCiAgICAgIHR5\
cGU6IHN0cmluZwogICAgICB0aXRsZTogS2V5Y2xvYWsgYWRtaW4gdXNlcm5hbWUKICAgIC0gbmFt\
ZTogQURNSU5fUEFTU1dPUkQKICAgICAgcmVxdWlyZWQ6IFRydWUKICAgICAgZGVmYXVsdDogYWRt\
aW4KICAgICAgdHlwZTogc3RyaW5nCiAgICAgIHRpdGxlOiBLZXljbG9hayBhZG1pbiBwYXNzd29y\
ZAogICAgLSBuYW1lOiBDVVNUT01fUkVBTE1fTkFNRQogICAgICByZXF1aXJlZDogRmFsc2UKICAg\
ICAgdHlwZTogc3RyaW5nCiAgICAgIHRpdGxlOiBOYW1lIG9mIHRoZSBLZXljbG9hayByZWFsbSAo\
ZGVmYXVsdHMgdG8gY3VycmVudCBuYW1lc3BhY2UpCiAgICAtIG5hbWU6IFVTRV9TSEFSRURfU0VS\
VklDRQogICAgICByZXF1aXJlZDogRmFsc2UKICAgICAgdHlwZTogYm9vbAogICAgICB0aXRsZTog\
Q29ubmVjdCB0byBhbiBleGlzdGluZyBzaGFyZWQgc2VydmljZQogICAgLSBuYW1lOiBTSEFSRURf\
SE9TVAogICAgICByZXF1aXJlZDogRmFsc2UKICAgICAgdHlwZTogc3RyaW5nCiAgICAgIHRpdGxl\
OiBVUkwgb2YgdGhlIHNoYXJlZCBzZXJ2aWNlCiAgICBiaW5kX3BhcmFtZXRlcnM6CiAgICAtIG5h\
bWU6IENMSUVOVF9JRAogICAgICByZXF1aXJlZDogVHJ1ZQogICAgICB0aXRsZTogTW9iaWxlIGNs\
aWVudCBJRCBvciBzZXJ2aWNlIG5hbWUKICAgICAgdHlwZTogc3RyaW5nCiAgICAtIG5hbWU6IENM\
SUVOVF9UWVBFCiAgICAgIHJlcXVpcmVkOiBUcnVlCiAgICAgIHRpdGxlOiBLZXljbG9hayBjbGll\
bnQgdHlwZQogICAgICB0eXBlOiBlbnVtCiAgICAgIGVudW06IFsnYmVhcmVyJywgJ3B1YmxpYydd"


COPY playbooks /opt/apb/actions
COPY roles /opt/ansible/roles
COPY vars /opt/ansible/vars
RUN ansible-galaxy install -r /opt/apb/actions/requirements.yml -p /opt/ansible/roles
RUN chmod -R g=u /opt/{ansible,apb}
USER apb